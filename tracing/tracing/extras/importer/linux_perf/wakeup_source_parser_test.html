<!DOCTYPE html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/core/test_utils.html">
<link rel="import" href="/tracing/extras/importer/linux_perf/ftrace_importer.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {
  test('wakeupSourceImport', function() {
    var lines = [
      ' <...>-3863  [001] d..2   350.517757: wakeup_source_activate: ' +
        'event3 state=0x10a60006',
      ' <...>-3863  [001] d..2   350.519930: wakeup_source_deactivate: ' +
        'event3 state=0x10aa0004',
      ' <...>-5158  [001] d.h3   350.553776: wakeup_source_activate: ' +
        'alarm state=0x10ab0004',
      ' <...>-3857  [002] d..2   350.554922: wakeup_source_activate: ' +
        'PowerManagerService.WakeLocks state=0x10ab0005',
      ' <...>-3857  [002] d..3   350.555103: wakeup_source_deactivate: ' +
        'alarm state=0x10ac0004',
      ' <...>-3857  [001] d..2   350.690087: wakeup_source_deactivate: ' +
        'PowerManagerService.WakeLocks state=0x10ad0003'
    ];
    var m = tr.c.TestUtils.newModelWithEvents([lines.join('\n')], {
      shiftWorldToZero: false
    });
    assert.isFalse(m.hasImportWarnings);

    var processes = m.getAllProcesses();
    assert.equal(processes.length, 1);

    var threads = m.getAllThreads();
    assert.equal(threads.length, 3);

    var thread1 = processes[0].getThread('event3');
    assert.isDefined(thread1);
    assert.equal(thread1.sliceGroup.length, 1);

    var thread2 = processes[0].getThread('alarm');
    assert.isDefined(thread2);
    assert.equal(thread2.sliceGroup.length, 1);

    var thread3 = processes[0].getThread('PowerManagerService.WakeLocks');
    assert.isDefined(thread3);
    assert.equal(thread3.sliceGroup.length, 1);
  });
});
</script>
