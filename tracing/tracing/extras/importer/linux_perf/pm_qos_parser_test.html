<!DOCTYPE html>
<!--
Copyright (c) 2013 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/core/test_utils.html">
<link rel="import" href="/tracing/extras/importer/linux_perf/ftrace_importer.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {
  test('pmQosImport', function() {
    var lines = [
      ' <...>-1594  [003] ...1   349.258458: pm_qos_update_request: ' +
        'pm_qos_class=CPU_DMA_LATENCY value=20',
      ' <...>-1594  [003] ...1   349.258458: pm_qos_update_target: ' +
        'action=UPDATE_REQ prev_value=2000000000 curr_value=20',
      ' <...>-1594  [003] ...1   349.258561: pm_qos_update_request: ' +
        'pm_qos_class=CPU_DMA_LATENCY value=100',
      ' <...>-1594  [003] ...1   349.258599: pm_qos_update_target: ' +
        'action=UPDATE_REQ prev_value=20 curr_value=100',
      ' <...>-1594  [003] ...1   349.258605: pm_qos_update_request: ' +
        'pm_qos_class=CPU_DMA_LATENCY value=-1',
      ' <...>-1594  [003] ...1   349.258606: pm_qos_update_target: ' +
        'action=UPDATE_REQ prev_value=100 curr_value=2000000000'
    ];
    var m = tr.c.TestUtils.newModelWithEvents([lines.join('\n')], {
      shiftWorldToZero: false
    });
    assert.isFalse(m.hasImportWarnings);

    var processes = m.getAllProcesses();
    assert.equal(processes.length, 1);

    var threads = m.getAllThreads();
    assert.equal(threads.length, 1);
    console.log(threads);

    var thread = processes[0].getThread('CPU_DMA_LATENCY');
    console.log(thread);
    assert.isDefined(thread);
    assert.equal(thread.sliceGroup.length, 4);
  });
});
</script>
